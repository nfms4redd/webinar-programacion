
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.7.5">
    
    
      
        <title>Servlet de acceso a base de datos - Curso de programación de NFMS4REDD</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-769c285a91.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../static/exercises/map-scale.css">
    
      <link rel="stylesheet" href="../../static/exercises/new-group-layer.css">
    
      <link rel="stylesheet" href="../../static/exercises/temperature.css">
    
      <link rel="stylesheet" href="../../static/exercises/wfs-query.css">
    
      <link rel="stylesheet" href="../../static/exercises/zoom-panel.css">
    
      <link rel="stylesheet" href="../../static/exercises/zoomto.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Curso de programación de NFMS4REDD" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Servidor
                </span>
              
            
            Servlet de acceso a base de datos
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Curso de programación de NFMS4REDD
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Índice" class="md-nav__link">
      Índice
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../setup/" title="Preparación" class="md-nav__link">
      Preparación
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Cliente
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Cliente
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../client/hello_world/" title="Hola mundo" class="md-nav__link">
      Hola mundo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client/add_ui/" title="Añadir elementos a la interfaz" class="md-nav__link">
      Añadir elementos a la interfaz
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client/reuse/" title="Reutilizar funcionalidad" class="md-nav__link">
      Reutilizar funcionalidad
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client/events/" title="Manejar eventos" class="md-nav__link">
      Manejar eventos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client/add_map_functionality/" title="Añadir funcionalidad al mapa" class="md-nav__link">
      Añadir funcionalidad al mapa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client/module_configuration/" title="Configuración de los módulos" class="md-nav__link">
      Configuración de los módulos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Servidor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Servidor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_world/" title="Hola mundo" class="md-nav__link">
      Hola mundo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config_servlet/" title="Servlet de configuración" class="md-nav__link">
      Servlet de configuración
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Servlet de acceso a base de datos
      </label>
    
    <a href="./" title="Servlet de acceso a base de datos" class="md-nav__link md-nav__link--active">
      Servlet de acceso a base de datos
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cargando-datos" title="Cargando datos" class="md-nav__link">
    Cargando datos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-el-proyecto" title="Creando el proyecto" class="md-nav__link">
    Creando el proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-el-servlet" title="Creando el servlet" class="md-nav__link">
    Creando el servlet
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conexion-manual-a-base-de-datos-en-java" title="Conexión manual a base de datos en Java" class="md-nav__link">
    Conexión manual a base de datos en Java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-configurada-en-el-portal" title="Conexión configurada en el portal" class="md-nav__link">
    Conexión configurada en el portal
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy_considerations/" title="Consideraciones sobre el despliegue" class="md-nav__link">
      Consideraciones sobre el despliegue
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../exercises/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cargando-datos" title="Cargando datos" class="md-nav__link">
    Cargando datos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-el-proyecto" title="Creando el proyecto" class="md-nav__link">
    Creando el proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-el-servlet" title="Creando el servlet" class="md-nav__link">
    Creando el servlet
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conexion-manual-a-base-de-datos-en-java" title="Conexión manual a base de datos en Java" class="md-nav__link">
    Conexión manual a base de datos en Java
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-configurada-en-el-portal" title="Conexión configurada en el portal" class="md-nav__link">
    Conexión configurada en el portal
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Servlet de acceso a base de datos</h1>
                
                <p>Ahora vamos a crear un servlet que nos muestre una lista con las provincias de Argentina.</p>
<h2 id="cargando-datos">Cargando datos</h2>
<p>Para ello, primero deberemos cargar las provincias en la base de datos. Nos descargamos los <a href="../../static/provincias.zip">datos</a> y los descomprimimos.</p>
<p>Luego ejecutamos el comando para cargarlos en la base de datos:</p>
<div class="codehilite"><pre><span></span>psql -h localhost -p <span class="m">65432</span> -U admin -d nfms -f provincias.sql
</pre></div>


<p>y comprobamos que se hayan cargado correctamente:</p>
<div class="codehilite"><pre><span></span>psql -h localhost -p <span class="m">65432</span> -U admin -d nfms -c <span class="s1">&#39;SELECT COUNT(*) FROM provincias&#39;</span>
</pre></div>


<h2 id="creando-el-proyecto">Creando el proyecto</h2>
<p>De nuevo, creamos el proyecto  y la configuración de nuestro servlet:</p>
<div class="codehilite"><pre><span></span>$ mvn archetype:generate -DgroupId<span class="o">=</span>org.fao.unredd -DartifactId<span class="o">=</span>provincias -DarchetypeArtifactId<span class="o">=</span>maven-archetype-quickstart -DinteractiveMode<span class="o">=</span><span class="nb">false</span>
</pre></div>


<p>con su configuración en el fichero <code>pom.xml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;dependencies&gt;</span>
    ...
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>3.0.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.github.geoladris<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>7.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>


<p>y en el <code>web-fragment.xml</code>:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;web-fragment</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-fragment_3_0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>provincias-servlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.fao.unredd.ProvinciasServlet<span class="nt">&lt;/servlet-class&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
  <span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>provincias-servlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/provincias<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-fragment&gt;</span>
</pre></div>


<h2 id="creando-el-servlet">Creando el servlet</h2>
<p>En este caso, nuestro servlet deberá conectar a la base de datos del portal. Para ello, existen diferentes alternativas, unas mejores que otras en función del contexto.</p>
<h3 id="conexion-manual-a-base-de-datos-en-java">Conexión manual a base de datos en Java</h3>
<p>Cuando queremos conectar a la base de datos desde un servicio Java tenemos que utilizar la API JDBC (Java DataBase Connectivity).</p>
<p>En general, el código para conectar a una base de datos en Java es el siguiente:</p>
<div class="codehilite"><pre><span></span><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
<span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span>
   <span class="s">&quot;jdbc:postgresql://hostname:port/dbname&quot;</span><span class="o">,</span><span class="s">&quot;username&quot;</span><span class="o">,</span> <span class="s">&quot;password&quot;</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</pre></div>


<blockquote>
<p>En el código anterior estamos conectando a una base de datos PostgreSQL, para lo cual instanciamos el driver <code>org.postgresql.Driver</code> y conectamos usando la URL propia de PostgreSQL <code>jdbc:postgresql://hostname:port</code>. Estos dos aspectos cambiarán en función del tipo de base de datos a la que estemos conectando.</p>
</blockquote>
<p>Primero, instanciamos el driver para que se autoregistre en el <code>DriverManager</code> y poder invocar después el método <code>getConnection</code> para obtener la conexión. Por último, es necesario cerrar la conexión.</p>
<p>Por medio del objeto de tipo <code>Connection</code> podremos obtener instancias de <code>Statement</code>, con las que se pueden enviar instrucciones SQL al servidor de base de datos.</p>
<h3 id="conexion-configurada-en-el-portal">Conexión configurada en el portal</h3>
<p>Aunque sería posible poner en el método <code>doGet</code> de nuestro servlet la creación de la conexión, no es recomendable ya que es un proceso costoso y ralentizaría nuestra aplicación.</p>
<p>Para evitar crear una conexión cada vez, el portal trae configurada una conexión de forma que sea Tomcat (el servidor) el que gestione las conexiones por nosotros. Pero, ¿cómo podemos obtener una de estas conexiones gestionadas por Tomcat?</p>
<p>El código Java cambia ligeramente, ya que ahora se obtiene un objeto de tipo <code>java.sql.DataSource</code> que es el que nos proporciona las conexiones:</p>
<div class="codehilite"><pre><span></span><span class="n">InitialContext</span> <span class="n">context</span><span class="o">;</span>
<span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialContext</span><span class="o">();</span>
  <span class="n">dataSource</span> <span class="o">=</span> <span class="o">(</span><span class="n">DataSource</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">lookup</span><span class="o">(</span><span class="s">&quot;java:/comp/env/jdbc/nfms&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&quot;Problema en la configuración&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="k">try</span> <span class="o">{</span>
  <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
  <span class="c1">// ...</span>
  <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&quot;No se pudo obtener una conexión&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="k">try</span> <span class="o">{</span>
  <span class="n">context</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// ignore</span>
<span class="o">}</span>
</pre></div>


<p>Si sutituímos la línea que contiene los puntos suspensivos por código que haga algo más interesante con la conexión, podemos devolver un JSON con el array de provincias que hay en la tabla que hemos cargado:</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">org.fao.unredd</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Statement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.naming.InitialContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.naming.NamingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">net.sf.json.JSONSerializer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProvinciasDBServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">InitialContext</span> <span class="n">context</span><span class="o">;</span>
    <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialContext</span><span class="o">();</span>
      <span class="n">dataSource</span> <span class="o">=</span> <span class="o">(</span><span class="n">DataSource</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">lookup</span><span class="o">(</span><span class="s">&quot;java:/comp/env/jdbc/nfms&quot;</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&quot;Problema en la configuración&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">provincias</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
      <span class="n">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
      <span class="n">ResultSet</span> <span class="n">result</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="s">&quot;SELECT fna FROM provincias&quot;</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">provincias</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;name_1&quot;</span><span class="o">));</span>
      <span class="o">}</span>

      <span class="n">resp</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
      <span class="n">JSONSerializer</span><span class="o">.</span><span class="na">toJSON</span><span class="o">(</span><span class="n">provincias</span><span class="o">).</span><span class="na">write</span><span class="o">(</span><span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">());</span>

      <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&quot;No se pudo obtener una conexión&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">context</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&quot;No se pudo liberar el recurso&quot;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Ahora, para probarlo tendremos que crear un plugin cliente con una lista que al cargar llame al servlet que acabamos de crear y rellene la lista con los nombres devueltos. Bastará crear un nuevo plugin con el siguiente módulo (para más detalles ver apartados sobre <a href="../../client/hello_world/">cliente</a>):</p>
<div class="codehilite"><pre><span></span><span class="nx">define</span><span class="p">([</span> <span class="s2">&quot;message-bus&quot;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bus</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
  <span class="nx">list</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;lista_provincias&#39;</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span>
  <span class="nx">bus</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;ajax&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;provincias&quot;</span><span class="p">,</span>
    <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">provincias</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">provincias</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">provincias</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;provincia&#39;</span><span class="p">;</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">errorMsg</span> <span class="o">:</span> <span class="s2">&quot;No se pudo obtener la lista de provincias&quot;</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>y los siguientes estilos:</p>
<div class="codehilite"><pre><span></span><span class="nt">div</span><span class="p">#</span><span class="nn">lista_provincias</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">25</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">999</span><span class="p">;</span>
    <span class="k">background</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="k">max-height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">overflow-y</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">div</span><span class="p">#</span><span class="nn">lista_provincias</span><span class="o">&gt;</span><span class="nt">div</span> <span class="p">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Por último, deberíamos poder instalar nuestro plugin, empaquetar la aplicación y reiniciar el portal para poder utilizar nuestro botón enlazado con nuestro servlet.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../config_servlet/" title="Servlet de configuración" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Servlet de configuración
              </span>
            </div>
          </a>
        
        
          <a href="../deploy_considerations/" title="Consideraciones sobre el despliegue" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Consideraciones sobre el despliegue
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-07b0fbb49b.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="../../static/exercises/filter.js"></script>
      
        <script src="../../static/exercises/map-scale.js"></script>
      
        <script src="../../static/exercises/measure.js"></script>
      
        <script src="../../static/exercises/new-group-layer.js"></script>
      
        <script src="../../static/exercises/temperature.js"></script>
      
        <script src="../../static/exercises/wfs-query.js"></script>
      
        <script src="../../static/exercises/zoom-panel-install-button.js"></script>
      
        <script src="../../static/exercises/zoom-panel.js"></script>
      
        <script src="../../static/exercises/zoomto.js"></script>
      
    
    
      
    
  </body>
</html>